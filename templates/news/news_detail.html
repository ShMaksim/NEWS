{% extends "default.html" %}

{% load custom_filters %}
{% load custom_tags %}
{% load cache %}
{% load i18n %}

{% block title %}
    {{ news.title }}
{% endblock title %}

{% block content %}
  <h1>{{ news.title|censor }}</h1>
  <p>{% trans "Publication date:" %} {{ news.created_at|date:"d.m.Y" }}</p>
  <p>{{ news.text|censor }}</p>

{% cache 300 categories request.LANGUAGE_CODE %}
<h2>{% trans "Categories:" %}</h2>
    <ul>
        {% for category in categories %}
            <li>
                {{ category.name }}
                {% if user.is_authenticated %}
                    {% if user in category.subscribers.all %}
                        <span>({% trans "You are subscribed" %})</span>
                    {% else %}
                        <form method="post" action="{% url 'subscribe_to_category' category.id %}">
                            {% csrf_token %}
                            <button type="submit">{% trans "Subscribe to" %} {{ category.name }}</button>
                        </form>
                    {% endif %}
                {% else %}
                    <span>({% trans "Log in to subscribe" %})</span>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% endcache %}

  <h2>{% trans "Comments" %}</h2>
  <ul>
    {% for comment in news.comment_set.all %}
      <li>
        <p>{{ comment.user.username }} ({{ comment.created_at }}): {{ comment.text }}</p>
        <p>{% trans "Rating:" %} {{ comment.rating }}</p>
      </li>
    {% endfor %}
  </ul>
{% endblock %}